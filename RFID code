#include <SPI.h>
#include <MFRC522.h>

#define RST_PIN 9
#define SS_PIN 10

MFRC522 mfrc522(SS_PIN, RST_PIN);   // Create MFRC522 instance.
  
void setup() {
   Serial.begin(9600);
   SPI.begin();      // Initiate  SPI bus
   mfrc522.PCD_Init();   // Initiate MFRC522
   Serial.println("RFID reader is ready. Tap card.");
}


void loop() {
   char uid_array[32] = "";
   rfid_get_uid(uid_array);
   if (strcmp(uid_array, "")== 0) {return;}
   else {Serial.println(uid_array);}
}

void rfid_get_uid(char uid[]) {
  if ( ! mfrc522.PICC_IsNewCardPresent()) {
      return;
   }

   // Select one of the cards
   if ( ! mfrc522.PICC_ReadCardSerial()) {
      return;
   }
   //Serial.print* is for testing purposes
   Serial.println("Card tapped"); 
   
   //convert uid byte data to human readable hex 
   byte_to_hexstring(mfrc522.uid.uidByte, uid);
   
   //Print the output uid string
   Serial.print("UID: "); 
   //Serial.println(uid);
   
   //Prevents scanner from scanning the same card too many times
   mfrc522.PICC_HaltA();
   
   Serial.println("Card scanned");
}

void byte_to_hexstring(byte array[], char id_array[])
{
   for (int i = 0; i < 4; i++)
   {
      byte digit1 = (array[i] >> 4) & 0x0F;
      byte digit2 = (array[i]) & 0x0F;
      id_array[i*2] = digit1  < 0xA ? '0' + digit1 : 'A' + digit1 - 0xA;
      id_array[i*2+1] = digit2  < 0xA ? '0' + digit2 : 'A' + digit2 - 0xA;
   }
   id_array[4*2] = '\0';
}
